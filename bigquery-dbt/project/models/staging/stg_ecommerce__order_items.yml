version: 2  # Określenie wersji pliku konfiguracji dbt

models:
  - name: stg_ecommerce__order_items  # Nazwa modelu dbt
    description: "Tabela zawierająca pozycje zamówień, czyli pojedyncze produkty w ramach zamówień e-commerce."

    columns:
      - name: order_item_id  # Identyfikator pozycji zamówienia
        description: "Unikalny identyfikator każdej pozycji w zamówieniu."
        tests:
          - not_null  # Test sprawdzający, czy kolumna nie zawiera wartości null
          - unique  # Test sprawdzający unikalność wartości w kolumnie

      - name: order_id  # Identyfikator zamówienia
        description: "Identyfikator zamówienia, do którego należy dana pozycja zamówienia."
        tests:
          - not_null  # Test sprawdzający, czy kolumna nie zawiera wartości null
          - relationships:  # Test relacji – sprawdza, czy wartość order_id istnieje w tabeli zamówień
              to: ref('stg_ecommerce__orders')  # Odniesienie do modelu 'stg_ecommerce__orders'
              field: order_id  # Sprawdzenie, czy order_id istnieje w tej tabeli

      - name: user_id  # Identyfikator użytkownika
        description: "Identyfikator użytkownika, który dokonał zakupu."
        tests:
          - not_null  # Test sprawdzający, czy kolumna nie zawiera wartości null

      - name: product_id  # Identyfikator produktu
        description: "Identyfikator produktu, który został zakupiony w ramach zamówienia."
        tests:
          - not_null  # Test sprawdzający, czy kolumna nie zawiera wartości null
          - relationships:  # Test relacji – sprawdza, czy wartość product_id istnieje w tabeli produktów
              to: ref('stg_ecommerce__products')  # Odniesienie do modelu 'stg_ecommerce__products'
              field: product_id  # Sprawdzenie, czy product_id istnieje w tej tabeli

      - name: item_sale_price  # Cena sprzedaży pozycji zamówienia
        description: "Cena sprzedaży dla konkretnej pozycji w zamówieniu."
        tests:
          - not_null  # Test sprawdzający, czy kolumna nie zawiera wartości null